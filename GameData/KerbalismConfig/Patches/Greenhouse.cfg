// ============================================================================
// Define greenhouse process
// ============================================================================

@KERBALISM_PROFILE:FOR[Kerbalism]
{
  PROCESS
  {
    // Photosynthesis reaction: 2xH2O + CO2 -> O2 + CH2O + H2O
    // Note that CH2O is an intermediate carbohydrate, energy that goes into the
    // food, in the actual food it can be any CxHyOz compound

    // In a hydroponic system plants grow in water containing nutrients, the
    // system is assumed to be closed loop.
    // Water efficient foods require around 250-500 L water per kg of crop, see
    // https://www.theguardian.com/news/datablog/2013/jan/10/how-much-water-food-production-waste
    // In a regenerative system (see https://www.ag.arizona.edu/lunargreenhouse/Documents/2012-07-20_01_Giacomelli.pdf
    // slide 19) water is also produced.
    // 1 unit of Food has a mass 0.28 kg (see community resource pack),
    // therefore we will use 1.8 L/kg * 0.28 kg = 0.5 L of Water
    // 1 unit of Water matches 1 L, so we need 0.5 units of Water per unit of Food.

    name = greenhouseProcess
    title = Greenhouse
    desc = Growing space tomatoes is fun and juicy. Don't mind the green glow, that's normal.
    canToggle = false
    INPUT
    {
      name = ElectricCharge
      rate = 0.01
    }
    INPUT
    {
      name = KsmWasteAtmosphere
      rate = 0.1
      substitute = CarbonDioxide
    }
    INPUT
    {
      name = CarbonDioxide
      rate = 0.1
    }
    INPUT
    {
      name = Ammonia
      rate = 0.1
    }
    INPUT
    {
      name = Water
      rate = 0.1
    }
    OUTPUT
    {
      name = Food
      rate = 0.1
    }
    OUTPUT
    {
      name = Oxygen
      rate = 0.1
      dumpByDefault = true
    }
    OUTPUT
    {
      name = WasteWater
      rate = 0.1
      dumpByDefault = true
    }
  }

  PROCESS
  {
    name = greenhouseSetupProcess
    title = Greenhouse preparation
    desc = Generate substrate to grow plants on
    canToggle = false
    INPUT
    {
      name = ElectricCharge
      rate = 0.02
    }
    INPUT
    {
      name = KsmWasteAtmosphere
      rate = 0.1
    }
    INPUT
    {
      name = Ammonia
      rate = 0.1
    }
    INPUT
    {
      name = Water
      rate = 0.1
    }
    OUTPUT
    {
      name = Substrate
      rate = 0.1
    }
    OUTPUT
    {
      name = WasteWater
      rate = 0.1
      dumpByDefault = true
    }
  }
}

@PART[kerbalism-greenhouse]:FOR[Kerbalism]
{
  MODULE
  {
    name = ModuleKsmGreenhouse

    lamps = Cylinder001               // object with emissive texture used to represent lamp intensity graphically

    anim_shutters = door              // animation to manipulate shutters
    anim_shutters_reverse = true

    anim_plants =                     // animation to represent plant growth graphically
    anim_plants_reverse = false

    growthProcessName = greenhouseProcess
    growthProcessCapacity = 1

    setupProcessName = greenhouseSetupProcess
    setupProcessCapacity = 1

    minLight = 400 // minimum lighting flux required for growth, in W/m^2
    maxRadiation = 0.00001   // maximum radiation allowed for growth in rad/s (plants are very tolerant towards radiation)

    substrateResourceName = Substrate
    substrateCapacity = 50
  }
}
